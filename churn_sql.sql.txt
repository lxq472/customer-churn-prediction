-- Customer Churn Feature Engineering

CREATE TABLE customer_features AS
SELECT
    customer_id,
    COUNT(*) AS total_orders,
    SUM(revenue) AS total_revenue,
    AVG(revenue) AS avg_order_value,
    MAX(order_date) AS last_purchase_date,
    CURRENT_DATE - MAX(order_date) AS days_since_last_purchase,

    CASE
        WHEN CURRENT_DATE - MAX(order_date) > 180 THEN 1
        ELSE 0
    END AS churn_flag

FROM orders
GROUP BY customer_id;
